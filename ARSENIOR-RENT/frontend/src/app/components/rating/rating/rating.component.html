<app-navbar></app-navbar>

<main class="min-h-screen bg-gray-50 section-padding">
  <div class="container-custom">
    <div class="max-w-2xl mx-auto">
      
      <h1 class="font-playfair text-center mb-4">Califica tu Experiencia</h1>
      <div class="divider"></div>

      @if (reservation()) {
        <div class="card mt-8 mb-6 text-center">
          <h3 class="font-playfair mb-2">{{ reservation()!.car?.brand }} {{ reservation()!.car?.model }}</h3>
          <p class="text-gray-600">Reserva #{{ reservation()!.id }}</p>
        </div>
      }

      @if (success()) {
        <div class="success-message text-center">
          ¡Gracias por tu calificación! Redirigiendo...
        </div>
      }

      @if (error()) {
        <div class="error-message">{{ error() }}</div>
      }

      @if (!success()) {
        <!-- Rating Categories -->
        <div class="card mb-6">
          <div class="space-y-8">
            
            <!-- Vehicle Condition -->
            <div>
              <label class="block mb-3">Condición del Vehículo</label>
              <div class="flex items-center justify-center gap-2">
                @for (star of getStars(5); track star) {
                  <button
                    (click)="setRating('vehicleCondition', star)"
                    class="text-4xl transition-colors"
                    [class.text-black]="star <= vehicleCondition"
                    [class.text-gray-300]="star > vehicleCondition"
                  >
                    {{ star <= vehicleCondition ? '★' : '☆' }}
                  </button>
                }
              </div>
              <p class="text-center text-sm text-gray-600 mt-2">{{ vehicleCondition }} de 5</p>
            </div>

            <!-- Cleanliness -->
            <div>
              <label class="block mb-3">Limpieza</label>
              <div class="flex items-center justify-center gap-2">
                @for (star of getStars(5); track star) {
                  <button
                    (click)="setRating('cleanliness', star)"
                    class="text-4xl transition-colors"
                    [class.text-black]="star <= cleanliness"
                    [class.text-gray-300]="star > cleanliness"
                  >
                    {{ star <= cleanliness ? '★' : '☆' }}
                  </button>
                }
              </div>
              <p class="text-center text-sm text-gray-600 mt-2">{{ cleanliness }} de 5</p>
            </div>

            <!-- Performance -->
            <div>
              <label class="block mb-3">Rendimiento del Vehículo</label>
              <div class="flex items-center justify-center gap-2">
                @for (star of getStars(5); track star) {
                  <button
                    (click)="setRating('performance', star)"
                    class="text-4xl transition-colors"
                    [class.text-black]="star <= performance"
                    [class.text-gray-300]="star > performance"
                  >
                    {{ star <= performance ? '★' : '☆' }}
                  </button>
                }
              </div>
              <p class="text-center text-sm text-gray-600 mt-2">{{ performance }} de 5</p>
            </div>

            <!-- Customer Service -->
            <div>
              <label class="block mb-3">Servicio al Cliente</label>
              <div class="flex items-center justify-center gap-2">
                @for (star of getStars(5); track star) {
                  <button
                    (click)="setRating('customerService', star)"
                    class="text-4xl transition-colors"
                    [class.text-black]="star <= customerService"
                    [class.text-gray-300]="star > customerService"
                  >
                    {{ star <= customerService ? '★' : '☆' }}
                  </button>
                }
              </div>
              <p class="text-center text-sm text-gray-600 mt-2">{{ customerService }} de 5</p>
            </div>
          </div>
        </div>

        <!-- Overall Rating -->
        <div class="card mb-6 bg-black text-white text-center py-8">
          <p class="text-sm uppercase tracking-wider mb-2">Calificación General</p>
          <p class="text-5xl font-playfair">{{ getOverallRating().toFixed(1) }}</p>
          <div class="flex justify-center gap-1 mt-4">
            @for (star of getStars(5); track star) {
              <span class="text-2xl">
                {{ star <= Math.round(getOverallRating()) ? '★' : '☆' }}
              </span>
            }
          </div>
        </div>

        <!-- Comments -->
        <div class="card mb-6">
          <label>Comentarios (opcional)</label>
          <textarea
            [(ngModel)]="comments"
            rows="5"
            placeholder="Cuéntanos sobre tu experiencia..."
          ></textarea>
        </div>

        <!-- Submit -->
        <div class="flex gap-4">
          <a routerLink="/my-reservations" class="btn-secondary flex-1 text-center">
            Cancelar
          </a>
          <button
            (click)="submitRating()"
            class="btn-primary flex-1"
            [disabled]="loading()"
          >
            @if (loading()) {
              <span class="loading"></span>
            } @else {
              Enviar Calificación
            }
          </button>
        </div>
      }
    </div>
  </div>
</main>

<app-footer></app-footer>